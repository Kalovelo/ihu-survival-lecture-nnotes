# Αρχές Αξιόπιστης Μεταφοράς Δεδομένων

Γενικό πρόβλημα: Υπάρχει πρόβλημα αξιόπιστης μεταφοράς δεδομένων τόσο στο επίπεδο μεταφοράς όσο **και στο επίπεδο ζεύξης και δικτύου**.

Με ένα αξιόπιστο κανάλι, τα μεταφερόμενα bit δεδομένων 
1. δεν αλλοιώνονται,
2. δεν χάνονται και
3. παραδίδονται όλα  με τη σωστή σειρά.

Το **πρωτόκολο αξιόπιστης μεταφοράς δεδομενων (Reliable data trasfer protocol)** κάνει αυτή τη δουλίτσα.

## RDT 1.0: Ουτοπία

- Η πιο απλή περίπτωση
- Θεωρούμε ότι το κανάλι είναι **πλήρως αξιόπιστο** 
- Έχουμε 
  - Ο Αποστολέας
    - έχει μια κατάσταση (state)
    - Δέχεται δεδομένα απ'το ανώτερο επίπεδο
    - Δημιουργεί πακέτο
    - Στέλνει πακέτο στο κανάλι
  - Ο Δέκτης
    - έχει μια κατάσταση (state)
    - Δέχεται ένα πακέτο από το κανάλι
    - Αφαιρεί τα δεδομένα από το πακέτο
    - Περνά τα δεδομένα στο ανώτερο επίπεδο.
- Δεν υπάρχει διαφορά μεταξύ μονάδα δεδομένου και πακέτο. 
- Όλη η ροή γίνεται από τον αποστολέα προς τον παραλήπτη.
- **Θεωρούμε πως τίποτα δεν θα πάει στραβά.**

## RDT 2.0: Έσκασε Ρεαλισμός

- Πιθανή **αλλοίωση** πακέτου


- Χρήση Θετικών και αρνητικών Επιβεβαιώσεων
  - **ACK & NAK**
- Αυτά τα πρωτόκολλα ονομάζονται **ARQ (Automatic Repeat reQuest)**
- Έχει 3 Δυνατότητες
  1. **Ανίχνευση Σφαλμάτων**: Απαιτείται μηχανισμός για ανίχνευση αλλοιωμένου bit. Όπως στο UDP, χρησιμοποιείται το **πεδίο αθροίσματος ελέγχου - Checksum**
  2. **Ανάδραση Παραλήπτη**: Ο παραλήπτης θα πρέπει να **ενημερώνει τον αποστολέα** για σωστή η εσφαλμένη λήψη πακέτου μέσω μηνυμάτων **ACK & NAK** αντίστοιχα.
  3. **Επαναμετάδοση**: Ένα πακέτο που **λαμβάνεται λανθασμένα**, πρει να επαναμεταδίδεται από τον αποστολέα. 
- **Ο αποστολέας**
  - έχει 2 καταστάσεις
    1. Αναμονή δεδομένων από το επίπεδο εφαρμογής
    2. Αναμονή επιβεβαίωσης από παραλήπτη
       - Αν ACK
         - Επιστροφή στο 1. για αναμονή επόμενου πακέτου προς αποστολή
       - Αν NAK
          - Επαναμετάδοσε το τελευταίο πακέτο και επιστροφή στο 2.
     - **Δεν μπορεί** να στείλει τα επόμενα πακέτα μέχρι να επιβεβαιωθεί πως έχει γίνει **σωστή λήψη του τελευταίου.**
- Γνωστό ως πρωτόκολλο **παύσης-και-αναμονής (stop-and-wait)**
- **Ο παραλήπτης**
  - Παίζει με μια κατάσταση
  - Στέλνει μια απάντηση ανάλογα με την ποιότητα της λήψης
  

### RDT 2.1: Κι αν λουστεί η απάντηση; 
Τι γίνεται όμως αν αλλοιωθεί μια απάντηση ACK / NAK?

Στο RDT 2.1
- Ο αποστολέας
  - αριθμεί τα πακέτα δεδομένων του, εισάγοντας έναν αριθμό ακολουθίας (sequence number)

  - Έχει 4 καταστάσεις

    1. **Αναμονή δεδομένων** από επίπεδο εφαρμογής
       - Αποστολή δεδομενων με SEQ = 0 

    2.  **Αναμονή απόκρισης** παραλήπτη
        - ΑΝ ACK: Επιστροφή στο 1
        - ΑΝ NAK: Πήγαινε στην κατάσταση 3

    3. **Ετοιμότητα** για Επαναμετάδοση
       - Εφόσον ήρθε NAK, Επαναμετάδοσε με SEQ = 1 

    4. Αναμονή ACK ή NAK **Επαναμετάδοσης** 
        - ΑΝ ACK: Επιστροφή στο 1
        - ΑΝ NAK: Πήγαινε στην κατάσταση 3

- Ο παραλήπτης
  - Έχει 2 καταστάσεις
    1. Αναμονή πακέτου με SEQ = 0
       - Αν σωστή λήψη: 
         - Απάντηση με ACK
         - Αναμονή για επόμενο πακέτο 
       - Αν λανθασμένη λήψη: 
         - Απάντηση με NAK
         - Πήγαινε στην κατάσταση 2
    2. Αναμονή πακέτο με SEQ = 1
       - Αν σωστή λήψη:
         - Απάντηση με ACK
         - Επιστροφή στο 1
       - Αν λανθασμένη λήψη:
         - Απάντηση με ΝΑΚ
         - Αναμονή για Επαναμετάδοση
- Ελέγχει εάν το ληφθέν πακέτο είναι μια αναμετάδοση.

### RDT 2.2: Αυτό το ACK, για ποιο είναι;

Επειδή δεν είναι γνωστό για ποιο πακέτο έστειλε ο παραλήπτης επιβεβαίωση, στο RDT 2.2
- Ο παραλήπτης
  - Περιλαμβάνει στην επιβεβαίωση και τον αριθμό ακολουθίας πακέτου.

## RDT 3.0: Το πακέτο ξεγλίστρησε

Τι γίνεται όταν ένα πακέτο χαθεί; Τότε ο αποστολέας δεν θα ενημερωθεί ποτέ για την ποιότητα λήψης πακέτου του παραλήπτη.

Στο RDT 3.0
- Ο αποστολέας **επιπλέον**
  - Κατέχει ένα **χρονομετρητή αντίστροφης μέτρησης**
  - Επιλέγει μια διακριτική τιμή χρόνου.
  - Εκκινεί το χρονομετρητή με κάθε αποστολή πακέτου
  - Αν δεν ληφθεί κάποια απάντηση μέχρι τη διακοπή χρονομετρητή, επαναμετάδοσε.
  - Παύση χρονομετρητή στη λήψη επιβεβαίωσης.
- Επειδή οι αριθμοί ακολουθίας πακέτων εναλλάσονται ανάμεσα στο 0 και 1, το πρωτόκολλο είναι γνωστό ως **πρωτόκολλο εναλλασόμενου bit**