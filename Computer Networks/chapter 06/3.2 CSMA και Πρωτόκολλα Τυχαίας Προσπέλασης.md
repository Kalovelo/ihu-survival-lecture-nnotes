# CSMA και Πρωτόκολλα Τυχαίας Προσπέλασης

Η δεύτερη τάξη πρωτοκόλλων πολλαπλής προσπέλασης έιναι τα πρωτόκολλα τυχαίας προσπέλασης. Σε αυτό το πρωτόκολλο, ένας εκπέμπων κόμβος εκπέμπει **πάντα** στον **πλήρη ρυθμό** του καναλιού, δηλαδή R bps.

Όταν υπάρξει σύγκρουση, κάθε κόμβος που εμπλέκεται στην σύγκρουση **επανεκπέμπει συνεχώς** το πλαίσιο του **μέχρι να περάσει χωρίς σύγκρουση** (brute force omega lul).  
Βέβαια, **δεν επανεκπέμπει αμέσως** αλλά **περιμένει μια τυχαία καθυστέρηση** πριν ξαναμεταδώσει. Κάθε κόμβος **επιλέγει ανεξάρτητες τυχαίες καθυστερήσεις**. Έτσι, επειδή επιλέγονται ανεξάρτητα, κάποια στιγμή ένας κόμβος θα καταφέρει να μεταδώσει το πακέτο.

## CSMA


Κανόνες Ευγένιας (ψιλό sos)

1. **Άκου πριν μιλήσεις** - Εάν κάποιος μιλά, περίμενε μέχρι να τελειώσει.
   - Στον κόσμο της δικτύωσης αυτό καλείται **ανίχνευση φέροντος (carrier sensing)**. Ένας κόμβος κάνει ακρόαση **πριν μεταδώσει**. Εάν ένα πλαίσιο από έναν άλλο κόμβο μεταδίδεται αυτή τη στιγμή με΄σα στο κανάλι, τότε ο κόμβος περιμένει μέχρι να ανιχνεύσει ότι δεν υπάρχει μετάδοση για ένα μικρό χρονικό διάστημα και μετά αρχίζει τη μετάδοση.
   - 
2. **Εάν κάποιος άλλος αρχίσει να μιλά ταυτόχρονα, σταμάτα να μιλάς**
   - Στον κόσμο της δικτύωσης αυτό καλείται **ανίχνευση σύγκρουσης (collision detection)**.
   - Ένας κόμβος που μεταδίδει κάνει ακρόαση στο κανάλι **ενώ μεταδίδει**. Εάν ανιχνεύσει ότι ένας άλλος κόμβος μεταδίδει ένα πλαίσιο και κάνει παρεμβολές, τότε σταματά να μεταδίδει και περιμένει ένα τυχαίο χρονικό διάστημα πριν να επαναλάβει τον κύκλο ανίχνευσης και μετάδοσης, δηλαδή όταν το κανάλι είναι αδρανές.

### Ερώτησις - Εφόσον κάθε κόμβος κάνει ακρόαση, γιατί υπάρχουν συγκρούσεις

Well, Ακόμη και στην ακρόαση, υπάρχουν καθυστερήσεις.  
Συγκεκριμένα η **καθυστέρηση διάδοσης καναλιού (channel propagation delay)** ευθύνεται για αυτό. Είναι ο χρόνος που χρειάζεται ένα σήμα για να διαδοθεί από έναν κόμβο σε έναν άλλον. Καθορίζει **άμεσο ρόλο στην απόδοση**.

- **Όσο μεγαλύτερη** είναι η **καθυστέρηση διάδοσης**, τόσο **μεγαλύτερη είναι η πιθανότητα συγκρούσεων**, διότι ένας κόμβος προς εκπομπή **δεν θα ανιχνεύσει εγκαίρως τη μετάδοση**.


## (CSMA/CD) Πολλαπλή Προσπέλαση με Ανίχνευση Φέροντος με Ανίχνευση Σύγκρουσης

Το CSMA/CD χρησιμοποιεί τον αλγόριθμο **δυαδικής εκθετικής υποχώρησης (binary exponential backoff)** οποιός χρησιμοποιείται και στο **Ethernet**. Όταν μεταδίδει ένα πλαίσιο που έχει ήδη υποστεί n συγκρούσεις ένας κόμβος επιλέγει την τιμή του K τυχαία από την περιοχή (0,1,2,....,2^n - 1).  
Όσο περισσότερες συγκρούσεις υποστεί ένα πλαίσιο, τόσο μεγαλύτερο θα είναι το χρονικό διάστημα, από το οποίο επιλέγεται το K. Για το Ethernet, το πραγματικό χρονικό διάστημα που περιμένει ένας κόμβος είναι K * 512 bit, δηλαδή Κ φορές το χρόνο που χρειάζεται για να στείλει 512 bit μέσα στο Ethernet. **Η μέγιστη τιμή που παίρνει το n είναι 10**.

### Απόδοση του CSMA/CD

Όταν 1 μόνο κόμβος έχει να στείλει πλαίσιο, ο κόμβος μπορεί να μεταδώσει με τον **πλήρη ρυθμό του καναλιού**. Ορίζουμε την απόδοση του CSMA/CD  ως το μακροπρόθεσμο κλάσμα του χρόνου κατά τον οποίο μεταδίδονται πλαίσια στο κανάλι χωρίς συγκρούσεις όταν υπάρχει ένας μεγάλος αριθμός ενεργών κόμβων, με κάθε κόμβο να έχει πλαίσια προς αποστολή.

**Απόδοση = 1/ (1 + 5Dprop/Dtrans)**

**Dprop** = μέγιστος χρόνος διάδοσης  
**Dtrans** = ο χρόνος για μετάδοση ενός πλαίσου Ethernet μεγίστου μεγέθους.