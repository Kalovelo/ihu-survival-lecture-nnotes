# Διευθυνσιοδότηση IPv4

Ένας υπολογιστής συνήθως έχει 1 μόνο ζεύξη μέσα στο δίκτυο. Όταν το IP στον υπολογιστή θέλει να στείλει ένα δεδομενόγραμμα, το κάνει μέσω αυτής της ζεύξης.

❗Το όριο ανάμεσα στον υπολογιστή και τη φυσική ζεύξη λέγεται **διεπαφή (interface)**. Διεπαφή επίσης ονομάζεται το **όριο** μεταξύ δρομολογητή και οποιαδήποτε από τις ζεύξεις του.

Ένας δρομολογητής λοιπόν, έχει τόσες διεπαφές όσες και οι ζεύξεις του.

Το IP **απαιτεί κάθε δρομολογητής και κάθε υπολογιστής** να έχει τη δική του **διεύθυνση IP**. Τεχνικά, μια διεύθυνση IP σχετίζεται με μια διεπαφή και όχι τόσο  με δρομολογητή/υπολογιστή

Κάθε διεύθυνση IP **έχει μήκος 32-bit**.

❗Ένα δίκτυο που συνδέει υπολογιστές και ανήκει σε ένα μεγαλύτερο δίκτυου, ονομάζεται **υποδίκτυο (subnet)**. Κάθε υποδίκτυο, έχει μια διεύθυνση μορφής π.χ.  223.1.1.0/24. 

❗ο συμβολισμός /24 καλείται **μάσκα υποδικτύου**. Αυτή δηλώνει τη διεύθυνση του υποδικτύου.

❗Όταν ένας υπολογιστής στείλει ένα δεδομενόγραμμα στη διεύθυνση 255.255.255.255, τότε αυτό προωθείται σε **κάθε υπολογιστή του υποδικτύου**. Αυτή η διεύθυνση, ονομάζεται broadcast. 


## Classless Interdomain Routing (CIDR)

Η στρατηγική εκχώρησης διευθύνσεων Διαδικτύου ονομάζεται Διατομεακή Δρομολόγηση χωρίς κλάσεις - Classless Interdomain Routing (CIDR). Η διεύθυνση IP χωρίζεται σε 2 μέρη και έχει πάλι δεκαδικό συμβολισμό με τελείες a.b.c.d/x. **Το x δηλώνει τον αριθμό bit στο πρώτο τμήμα διεύθυνσης.**

Τα x σημαντικότερα bit της διεύθυνσης, απαρτίζουν το τμήμα διεύθυνσης δικτύου και συχνά αναφέρονται ως **πρόθεμα δικτύου** της διεύθυνσης.  
Ένας οργανισμός παίρνει ένα κομμάτι συνεχόμενων διευθύνσεων με κοινό πρόθεμα.

Όταν ένας δρομολογητής έξω από το υποδίκτυο προωθεί ένα δεδομενόγραμμα, αν η διεύθυνση προορισμού του οποίου βρίσκεται μέσα στο υποδίκτυο, τότε εξετάζονται **μόνο τα αρχικά x bit της διεύθυνσης**. Αυτό βοηθάει γιατί **μειώνεται το μέγεθος του πίνακα προώθησης.** Μια καταχώρηση μορφής a.b.c.d/x αρκεί για προώθηση πακέτων **οπουδήποτε στο υποδίκτυο**.

Τα υπόλοιπα **32-x** διακρίνουν τις **συσκευές μέσα στο υποδίκτυο (εφόσον έχουν ίδιο πρόθεμα).**Αυτά λαμβάνονται υπόψη όταν προωθούνται δεδομενογράμματα **μέσα στο υποδίκτυο**.

## Διεθυνσιοδότηση με κλάσεις (classful addressing)

Πριν του CIDR, τα τμήματα δικτύου μιας διεύθυνσης IP περιοριζόταν σε μήκη 8, 16 ή 24 bit. Κάθε μια από τις προηγούμενες τιμές θεωρούνταν ως μια κλάση(A/B/C). Αυτό το μοντέλο δεν τα πήγαινε και πολύ καλά, γιατί ένας οργανισμός μπορούσε να **λάβει μεγαλύτερο φάσμα διευθύνσεων από ότι χρειάζεται,** δηλαδή περισσότερες διευθύνσεις από ότι συσκευές κατέχει. Αυτό είναι προβληματάκι, αφού γίνεται άσκοπη ιδιοκτησία.

## Απόκτηση Διεύθυνση Υπολογιστή: Πρωτόκολλο Dynamic Host Configuration Protocol, DHCP

Μόλις ένας οργανισμός λάβει ένα μπλοκ διευθύνσεων, τότε ο διαχειριστής του δικτύου θα πρέπει να παραμετροποιεί αυτοπροσώπος τις διευθύνσεις IP μέσα σοτ δρομολογητή, δηλαδή με το χεράκι.

ΑΛΛΑ ΓΙΑ ΣΤΑΣΟΥ ΛΙΓΟ!

❗Το πρωτόκολλο DHCP επιτρέπει σε έναν υπολογιστή να αποκτά μια διεύθυνση IP **αυτόματα**.  
Ένας διαχειριστής μπορεί να ορίσει στο DHCP έτσι ώστε κάθε φορά που συνδέεται ένας υπολογιστής σε ένα δίκτυο να λαμβάνει την ίδια διεύθυνση ΙΡ, ή να παίρνει μια **προσωρινή διεύθυνση (temporary address)**.  
Το DHCP επίσης επιτρέπει σε έναν υπολογιστή να μάθει πληροφορίες όπως
 - η μάσκα υποδικτύου του,
 - τη διεύθυνση του δρομολογητή του 
 - τη διεύθυνση πρώτου άλματος του δικού του δρομολογητή. 

Επειδή το DHCP μας λύνει τα χέρια αυτόματα, καλείται **πρωτόκολλο τοποθέτησης και άμεσης λειτουργίας (plug-and-play protocol) ή μηδενικής οαραμετροποίησης**.

Είναι ένα πρωτόκολλο πελάτη-εξυπηρετή. Ένας πελάτης είναι συνήθως ένας υπολογιστής που θέλει να πάρει πληροφορίες παραμετροποίησης δικτύου. Στην πιο απλή περίπτωση, κάθε **υποδίκτυο θα έχει έναν εξυπηρετή DHCP**. Αν δεν έχει, τότε απαιτείται ένας **πράκτορας αναμετάδοσης DHCP** (συνήθως δρομολογητής) που γνωρίζει τη διεύθυνση εξυπηρετή DHCP για το δίκτυο.

### Βήματα νέου αφικνούμενου υπολογιστή

1. **Ανακάλυηψη Εξυπηρετή DHCP**: Χρησιμοποιείται ένα **μήνυμα ανακάλυψης DHCP**, το οποίο στέλνει ένας πελάτης μέσα σε ένα πακέτο **UDP στη θύρα 67**. Ο υπολογιστής **δεν ξέρει** ποια είναι η διεύθυνση IP δικτύου που συνδέεται, άρα σίγουρα και όχι του DHCP server. Έτσι, το δεδομενόγραμμα έχει ως
  - Διεύθυνση προορισμού : 255.255.255.255 (broadcast)
  - Διεύθυνση προέλευσης : 0.0.0.0 "αυτός ο υπολογιστής".
2. **Προσφορά/ες DHCP server**: Ένας DHCP server που λαμβάνει ένα μήνυμα ανακάλυψης αποκρίνεται στον πελάτη με ένα **μήνυμα προσφοράς DHCP**, το οποίο εκπέμπεται σε όλους τους κόμβους του υποδικτύου (255.255.255.255). Εφόσον μπορεί να υπάρχουν πολλοί  DHCP servers στο δίκτυο, ο πελάτης μπορεί να διαλέξει. Το μήνυμα περιέχει
   - Ταυτότητα συναλλαγής ληφθέντος μηνύματος ανκάλυψης
   - Προτεινόμενη ΙΡ
   - Μάσκα δικτύου
   - Χρόνος Μίσθωσης: πόσο καιρό θα είναι έγκυρη η διεύθυνση
3. **Αίτηση DHCP**: Ο πελάτης επολέγει και αποκρίνεται με ένα **μήνυμα αίτησης DHCP** το οποίο ηχεί πίσω παραμέτρους ρύθμισης.
4. **DHCP ACK**: ο server αποκρίνεται στο μήνυμα αίτησης με ένα  που επιβεβαίωνει τις αιτούμενες παραμέτρους.
5. Ο πελάτης λαμβάνει και χρησιμοποιεί τη διεύθυνση IP. 